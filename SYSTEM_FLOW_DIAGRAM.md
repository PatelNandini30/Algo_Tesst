# Strike Selection System - Flow Diagram

## Complete Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (React)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  StrikeSelectionInput Component                               â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  [Expiry Dropdown]                                            â”‚  â”‚
â”‚  â”‚   â—‹ Weekly                                                    â”‚  â”‚
â”‚  â”‚   â—‹ Next Weekly                                               â”‚  â”‚
â”‚  â”‚   â—‹ Monthly                                                   â”‚  â”‚
â”‚  â”‚   â—‹ Next Monthly                                              â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  [Strike Type Dropdown]                                       â”‚  â”‚
â”‚  â”‚   â—‹ ATM                                                       â”‚  â”‚
â”‚  â”‚   â—‹ ITM  â†’ [Offset Input: 1-30]                              â”‚  â”‚
â”‚  â”‚   â—‹ OTM  â†’ [Offset Input: 1-30]                              â”‚  â”‚
â”‚  â”‚   â—‹ Premium Range â†’ [Min: ___] [Max: ___]                    â”‚  â”‚
â”‚  â”‚   â—‹ Closest Premium â†’ [Target: ___]                          â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                        â”‚
â”‚                              â”‚ User Input                             â”‚
â”‚                              â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Payload Construction                                         â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  {                                                            â”‚  â”‚
â”‚  â”‚    strike_selection_type: "OTM",                             â”‚  â”‚
â”‚  â”‚    strike_selection_value: 2,                                â”‚  â”‚
â”‚  â”‚    expiry_selection: "WEEKLY",                               â”‚  â”‚
â”‚  â”‚    option_type: "CE",                                        â”‚  â”‚
â”‚  â”‚    position: "SELL",                                         â”‚  â”‚
â”‚  â”‚    lots: 1                                                   â”‚  â”‚
â”‚  â”‚  }                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ HTTP POST
                               â”‚ /api/backtest/algotest
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BACKEND (FastAPI)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Router: backend/routers/backtest.py                         â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  â€¢ Receives payload                                           â”‚  â”‚
â”‚  â”‚  â€¢ Validates parameters                                       â”‚  â”‚
â”‚  â”‚  â€¢ Calls engine                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                        â”‚
â”‚                              â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Engine: backend/engines/generic_algotest_engine.py          â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  For each trade date:                                         â”‚  â”‚
â”‚  â”‚    1. Get spot price                                          â”‚  â”‚
â”‚  â”‚    2. Get strike interval (50/100)                           â”‚  â”‚
â”‚  â”‚    3. Call strike calculation                                â”‚  â”‚
â”‚  â”‚    4. Get premium                                             â”‚  â”‚
â”‚  â”‚    5. Calculate P&L                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                        â”‚
â”‚                              â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Base Functions: backend/base.py                              â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Strike Selection Router                                 â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  IF strike_type == "ATM":                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> calculate_strike_from_selection()               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         â€¢ Round(spot/interval) Ã— interval               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         â€¢ Return: 24350                                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  IF strike_type == "ITM" or "OTM":                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> calculate_strike_from_selection()               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         â€¢ Calculate ATM                                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         â€¢ Add/subtract offset Ã— interval                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         â€¢ Return: 24450 (for OTM2)                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  IF strike_type == "PREMIUM_RANGE":                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> calculate_strike_from_premium_range()           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         â€¢ Get all strikes with premiums                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         â€¢ Filter by min/max range                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         â€¢ Select closest to ATM                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         â€¢ Return: 24350 (â‚¹145)                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  IF strike_type == "CLOSEST_PREMIUM":                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> calculate_strike_from_closest_premium()         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         â€¢ Get all strikes with premiums                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         â€¢ Find closest to target                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         â€¢ Return: 24350 (â‚¹148)                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Expiry Selection                                        â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚
â”‚  â”‚  â”‚  get_expiry_for_selection()                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Load expiry CSV (weekly/monthly)                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Find current/next expiry                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Return: 2024-01-18 (Thursday)                     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Premium Lookup                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚
â”‚  â”‚  â”‚  get_option_premium_from_db()                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Load bhavcopy CSV (cached)                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Filter by strike, expiry, type                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Return: 145.50                                    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                        â”‚
â”‚                              â”‚ Results                                â”‚
â”‚                              â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Response Construction                                        â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  {                                                            â”‚  â”‚
â”‚  â”‚    trades: [                                                  â”‚  â”‚
â”‚  â”‚      {                                                        â”‚  â”‚
â”‚  â”‚        entry_date: "2024-01-15",                             â”‚  â”‚
â”‚  â”‚        entry_spot: 24350,                                    â”‚  â”‚
â”‚  â”‚        strike: 24450,                                        â”‚  â”‚
â”‚  â”‚        expiry: "2024-01-18",                                 â”‚  â”‚
â”‚  â”‚        entry_premium: 95.5,                                  â”‚  â”‚
â”‚  â”‚        exit_premium: 45.2,                                   â”‚  â”‚
â”‚  â”‚        pnl: 3267.5                                           â”‚  â”‚
â”‚  â”‚      }                                                        â”‚  â”‚
â”‚  â”‚    ],                                                         â”‚  â”‚
â”‚  â”‚    summary: { ... }                                          â”‚  â”‚
â”‚  â”‚  }                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ HTTP Response
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (React)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ResultsPanel Component                                       â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  ğŸ“Š Backtest Results                                          â”‚  â”‚
â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  Total Trades: 45                                             â”‚  â”‚
â”‚  â”‚  Winning Trades: 32 (71.11%)                                  â”‚  â”‚
â”‚  â”‚  Total P&L: â‚¹125,430.50                                       â”‚  â”‚
â”‚  â”‚  Max Profit: â‚¹8,500.00                                        â”‚  â”‚
â”‚  â”‚  Max Loss: -â‚¹12,300.00                                        â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  [Trade Details Table]                                        â”‚  â”‚
â”‚  â”‚  [P&L Chart]                                                  â”‚  â”‚
â”‚  â”‚  [Equity Curve]                                               â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Calculation Flow Examples

### Example 1: OTM2 Call

```
User Input:
â”œâ”€ Strike Type: OTM
â”œâ”€ Offset: 2
â”œâ”€ Expiry: WEEKLY
â””â”€ Option Type: CE

Backend Processing:
â”œâ”€ Entry Date: 2024-01-15
â”œâ”€ Spot Price: 24,350
â”œâ”€ Strike Interval: 50 (NIFTY)
â”‚
â”œâ”€ Step 1: Calculate ATM
â”‚   â””â”€ ATM = round(24350/50) Ã— 50 = 24,350
â”‚
â”œâ”€ Step 2: Apply OTM offset
â”‚   â””â”€ Strike = 24,350 + (2 Ã— 50) = 24,450
â”‚
â”œâ”€ Step 3: Get expiry
â”‚   â””â”€ Weekly expiry = 2024-01-18 (Thursday)
â”‚
â”œâ”€ Step 4: Get premium
â”‚   â””â”€ Premium = â‚¹95.50 (from bhavcopy)
â”‚
â””â”€ Result:
    â”œâ”€ Strike: 24,450
    â”œâ”€ Expiry: 2024-01-18
    â””â”€ Premium: â‚¹95.50
```

### Example 2: Premium Range

```
User Input:
â”œâ”€ Strike Type: PREMIUM_RANGE
â”œâ”€ Min Premium: 100
â”œâ”€ Max Premium: 200
â”œâ”€ Expiry: MONTHLY
â””â”€ Option Type: PE

Backend Processing:
â”œâ”€ Entry Date: 2024-01-15
â”œâ”€ Spot Price: 24,350
â”œâ”€ Strike Interval: 50 (NIFTY)
â”‚
â”œâ”€ Step 1: Get all strikes with premiums
â”‚   â”œâ”€ 24,200 â†’ â‚¹250
â”‚   â”œâ”€ 24,250 â†’ â‚¹180 âœ“ (in range)
â”‚   â”œâ”€ 24,300 â†’ â‚¹140 âœ“ (in range)
â”‚   â”œâ”€ 24,350 â†’ â‚¹105 âœ“ (in range)
â”‚   â””â”€ 24,400 â†’ â‚¹75
â”‚
â”œâ”€ Step 2: Filter by range (100-200)
â”‚   â”œâ”€ 24,250 â†’ â‚¹180 âœ“
â”‚   â”œâ”€ 24,300 â†’ â‚¹140 âœ“
â”‚   â””â”€ 24,350 â†’ â‚¹105 âœ“
â”‚
â”œâ”€ Step 3: Calculate ATM
â”‚   â””â”€ ATM = 24,350
â”‚
â”œâ”€ Step 4: Select closest to ATM
â”‚   â””â”€ 24,350 (distance: 0) âœ“
â”‚
â”œâ”€ Step 5: Get expiry
â”‚   â””â”€ Monthly expiry = 2024-01-31
â”‚
â””â”€ Result:
    â”œâ”€ Strike: 24,350
    â”œâ”€ Expiry: 2024-01-31
    â””â”€ Premium: â‚¹105.00
```

### Example 3: Closest Premium

```
User Input:
â”œâ”€ Strike Type: CLOSEST_PREMIUM
â”œâ”€ Target Premium: 150
â”œâ”€ Expiry: WEEKLY
â””â”€ Option Type: CE

Backend Processing:
â”œâ”€ Entry Date: 2024-01-15
â”œâ”€ Spot Price: 24,350
â”œâ”€ Strike Interval: 50 (NIFTY)
â”‚
â”œâ”€ Step 1: Get all strikes with premiums
â”‚   â”œâ”€ 24,250 â†’ â‚¹220
â”‚   â”œâ”€ 24,300 â†’ â‚¹175
â”‚   â”œâ”€ 24,350 â†’ â‚¹145 âœ“ (closest)
â”‚   â”œâ”€ 24,400 â†’ â‚¹110
â”‚   â””â”€ 24,450 â†’ â‚¹80
â”‚
â”œâ”€ Step 2: Calculate differences from target (150)
â”‚   â”œâ”€ 24,250 â†’ |220-150| = 70
â”‚   â”œâ”€ 24,300 â†’ |175-150| = 25
â”‚   â”œâ”€ 24,350 â†’ |145-150| = 5  âœ“ (minimum)
â”‚   â”œâ”€ 24,400 â†’ |110-150| = 40
â”‚   â””â”€ 24,450 â†’ |80-150| = 70
â”‚
â”œâ”€ Step 3: Select minimum difference
â”‚   â””â”€ 24,350 (difference: 5) âœ“
â”‚
â”œâ”€ Step 4: Get expiry
â”‚   â””â”€ Weekly expiry = 2024-01-18
â”‚
â””â”€ Result:
    â”œâ”€ Strike: 24,350
    â”œâ”€ Expiry: 2024-01-18
    â””â”€ Premium: â‚¹145.00
```

---

## Data Sources

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Files                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  strikeData/                                                 â”‚
â”‚  â”œâ”€ NIFTY_strike_data.csv                                   â”‚
â”‚  â”‚   â””â”€ Date, Ticker, Close (spot prices)                   â”‚
â”‚  â””â”€ BANKNIFTY_strike_data.csv                               â”‚
â”‚      â””â”€ Date, Ticker, Close (spot prices)                   â”‚
â”‚                                                               â”‚
â”‚  expiryData/                                                 â”‚
â”‚  â”œâ”€ NIFTY.csv (weekly)                                      â”‚
â”‚  â”‚   â””â”€ Previous Expiry, Current Expiry, Next Expiry        â”‚
â”‚  â”œâ”€ NIFTY_Monthly.csv                                       â”‚
â”‚  â”‚   â””â”€ Previous Expiry, Current Expiry, Next Expiry        â”‚
â”‚  â”œâ”€ BANKNIFTY.csv (weekly)                                  â”‚
â”‚  â””â”€ BANKNIFTY_Monthly.csv                                   â”‚
â”‚                                                               â”‚
â”‚  cleaned_csvs/                                               â”‚
â”‚  â”œâ”€ 2024-01-01.csv                                          â”‚
â”‚  â”œâ”€ 2024-01-02.csv                                          â”‚
â”‚  â””â”€ ... (bhavcopy data)                                     â”‚
â”‚      â””â”€ Symbol, Strike, OptionType, Expiry, Close, TurnOver â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Performance Flow

```
Request â†’ Router â†’ Engine â†’ Base Functions â†’ Data Files
  â†“         â†“        â†“           â†“              â†“
 <1ms     <1ms    Loop      <1ms/call      5ms (cached)
                   â†“
              Per Trade:
              â”œâ”€ Strike calc: <1ms
              â”œâ”€ Expiry lookup: <1ms (cached)
              â”œâ”€ Premium lookup: 5ms (cached)
              â””â”€ P&L calc: <1ms
              
Total per trade: ~7ms
100 trades: ~700ms
1000 trades: ~7 seconds
```

---

## Error Handling Flow

```
Frontend Validation
â”œâ”€ Empty fields â†’ Show error message
â”œâ”€ Invalid range â†’ Show error message
â””â”€ Valid input â†’ Send to backend
    â†“
Backend Validation
â”œâ”€ Invalid strike type â†’ Return 400 error
â”œâ”€ Missing required fields â†’ Return 400 error
â”œâ”€ Invalid date range â†’ Return 400 error
â””â”€ Valid input â†’ Process
    â†“
Data Validation
â”œâ”€ Missing bhavcopy â†’ Return 404 error
â”œâ”€ Missing expiry data â†’ Return 404 error
â”œâ”€ No strikes in range â†’ Return 404 error
â””â”€ Valid data â†’ Calculate
    â†“
Result
â””â”€ Success â†’ Return results
```

---

## Summary

This flow diagram shows:
1. Complete user journey from input to results
2. Backend processing steps
3. Strike calculation logic for each method
4. Data sources and caching
5. Performance characteristics
6. Error handling

The system is designed for:
- Fast calculations (<1ms per strike)
- Efficient data access (caching)
- Clear error messages
- Accurate trading logic
